swagger: '2.0'
info:
  title: Cost Analysis API
  version: 1.0.0
  description: >
    Custom connector for Azure Functions: analyze orphaned resources and run
    cost analysis.
host: YOUR-FUNCTION-APP-NAME.azurewebsites.net
basePath: /
schemes:
  - https
consumes:
  - application/json
produces:
  - application/json
paths:
  /api/cost-analysis:
    post:
      operationId: CostAnalysisDirectQuery
      summary: Calculate cost for specific resources
      description: Calculates cost for a list of Azure resource IDs.
      parameters:
        - in: body
          name: body
          required: true
          schema:
            $ref: '#/definitions/CostAnalysisRequest'
      responses:
        '200':
          description: Cost analysis result
          schema:
            $ref: '#/definitions/CostAnalysisResponse'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/ErrorResponse'
        '401':
          description: Unauthorized
          schema:
            $ref: '#/definitions/ErrorResponse'
        '500':
          description: Server error
          schema:
            $ref: '#/definitions/ErrorResponse'
definitions:
  CostAnalysisRequest:
    type: object
    additionalProperties: false
    required:
      - query_type
      - resource_ids
      - start_date
      - end_date
    properties:
      subscription_id:
        type: string
        description: Optional subscription id (if your backend uses it).
      query_type:
        type: string
        enum:
          - specific_resources
      resource_ids:
        type: array
        items:
          type: string
      start_date:
        type: string
        description: Date string (your function accepts it as-is).
      end_date:
        type: string
        description: Date string (your function accepts it as-is).
  CostAnalysisResponse:
    type: object
    properties:
      currency:
        type: string
      total_cost:
        type: number
        format: double
      start_date:
        type: string
      end_date:
        type: string
      breakdown:
        type: array
        items:
          type: object
          properties:
            resource_id:
              type: string
            cost:
              type: number
              format: double
            currency:
              type: string
  ErrorResponse:
    type: object
    properties:
      error:
        type: string
      message:
        type: string
      details:
        type: object
securityDefinitions:
  api_key:
    type: apiKey
    in: query
    name: code
security:
  - api_key: []
